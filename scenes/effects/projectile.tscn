[gd_scene load_steps=5 format=3 uid="uid://yyh4518er1qa"]

[sub_resource type="GDScript" id="GDScript_ehum3"]
script/source = "extends RigidBody3D

@export var lifetime: float = 5.0

var time_alive: float = 0.0
var trail: MeshInstance3D
var trail_points: Array = []

func _ready():
	contact_monitor = true
	max_contacts_reported = 4
	
	# Create trail mesh
	trail = MeshInstance3D.new()
	add_child(trail)
	var material = StandardMaterial3D.new()
	material.albedo_color = Color.YELLOW
	material.emission_enabled = true
	material.emission = Color.YELLOW
	trail.material_override = material

func _process(delta):
	time_alive += delta
	if time_alive >= lifetime:
		queue_free()
	
	# Update trail
	trail_points.append(global_position)
	if trail_points.size() > 10:
		trail_points.pop_front()
	
	update_trail_mesh()

func update_trail_mesh():
	if trail_points.size() < 2:
		return
	
	var arrays = []
	arrays.resize(Mesh.ARRAY_MAX)
	var vertices = PackedVector3Array()
	
	for point in trail_points:
		vertices.append(to_local(point))
	
	arrays[Mesh.ARRAY_VERTEX] = vertices
	
	var mesh = ArrayMesh.new()
	mesh.add_surface_from_arrays(Mesh.PRIMITIVE_LINE_STRIP, arrays)
	trail.mesh = mesh

func _on_body_entered(body):
	if body.has_method(\"hit\"):
		body.hit()
	queue_free()
"

[sub_resource type="SphereShape3D" id="SphereShape3D_6wb1f"]
radius = 0.01

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_eu3ok"]
albedo_color = Color(1, 0.73366666, 0.060000002, 1)

[sub_resource type="SphereMesh" id="SphereMesh_ombb5"]
material = SubResource("StandardMaterial3D_eu3ok")
radius = 0.01
height = 0.02

[node name="Projectile" type="RigidBody3D"]
mass = 5.0
gravity_scale = 0.01
script = SubResource("GDScript_ehum3")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("SphereShape3D_6wb1f")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("SphereMesh_ombb5")
